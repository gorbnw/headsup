<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Strings and Things ðŸ§¶</title>
  <style>
    body {
      font-family: 'Comic Sans MS', Arial, sans-serif;
      text-align: center;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #ffb6c1, #98ff98, #ffd1dc, #39ff14);
      color: #000;
      font-size: 1.5em;
    }

    #gameArea {
      flex: 3;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      text-shadow: 2px 2px 8px #fff;
      cursor: pointer;
      user-select: none;
      transition: transform 0.1s, color 0.2s;

      padding: 20px;
      max-width: 95vw;
      text-align: center;
      line-height: 1.1;
      word-break: break-word;
      white-space: normal;
      font-size: clamp(2.5rem, 8vw, 10rem);
    }

    #gameArea:active {
      transform: scale(0.95);
      color: #ff69b4;
    }

    #timer {
      font-size: 3em;
      margin: 20px;
      font-weight: bold;
      text-shadow: 1px 1px 3px #fff;
    }

    #controls {
      margin: 20px;
      background: rgba(255, 255, 255, 0.3);
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(5px);
      font-size: 1.5em;
    }

    #resultsOverlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      cursor: pointer;
    }

    #resultsContent {
      background: rgba(255,255,255,0.95);
      padding: 40px;
      border-radius: 15px;
      max-height: 80%;
      overflow-y: auto;
      font-size: 1.5em;
    }

    .correct { color: #39ff14; font-weight: bold; }
    .missed  { color: #ff69b4; font-weight: bold; }

    #resultsContent ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    button {
      padding: 15px 30px;
      font-size: 1.5em;
      border: none;
      border-radius: 10px;
      background: #ffb6c1;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #39ff14;
    }

    select, input[type=number] {
      font-size: 1.5em;
      padding: 10px;
      border-radius: 5px;
      border: none;
    }
  </style>
</head>
<body>
  <h1>Strings and Things ðŸ§¶</h1>

  <div id="controls">
    <label for="presetSelect">Choose a word list:</label>
    <select id="presetSelect"></select><br><br>

    <label>Timer (seconds):
      <input type="number" id="timeInput" value="60">
    </label><br><br>

    <button id="startBtn">Start</button>
  </div>

  <div id="timer" style="display:none"></div>
  <div id="gameArea" style="display:none"></div>

  <div id="resultsOverlay">
    <div id="resultsContent"></div>
  </div>

  <audio id="startSound" src="start.wav"></audio>
  <audio id="countdownSound" src="countdown.wav"></audio>
  <audio id="endSound" src="end.wav"></audio>

  <script>
    const presetSelect = document.getElementById('presetSelect');
    const startBtn = document.getElementById('startBtn');
    const timeInput = document.getElementById('timeInput');
    const timerEl = document.getElementById('timer');
    const gameArea = document.getElementById('gameArea');
    const resultsOverlay = document.getElementById('resultsOverlay');
    const resultsContent = document.getElementById('resultsContent');
    const controlsEl = document.getElementById('controls');

    let words = [];
    let availableWords = [];
    let usedWords = new Set();
    let currentWord = "";
    let results = [];
    let timeLeft = 0;
    let interval = null;
    let playing = false;

    function prettyName(filename) {
      return filename
        .replace('.txt','')
        .replace(/[_-]/g, ' ')
        .replace(/\b\w/g, c => c.toUpperCase());
    }

    async function loadWordLists() {
      const res = await fetch('index.json');
      const files = await res.json();

      files
        .sort((a, b) => prettyName(a).localeCompare(prettyName(b)))
        .forEach(file => {
          const option = document.createElement('option');
          option.textContent = prettyName(file);
          option.value = file;
          presetSelect.appendChild(option);
        });
    }

    async function loadWords(file) {
      const res = await fetch(`lists/${file}`);
      const text = await res.text();
      return text.split(/\r?\n/).filter(Boolean);
    }

    function showWord() {
      if (availableWords.length === 0) {
        endGame(true);
        return;
      }
      const i = Math.floor(Math.random() * availableWords.length);
      currentWord = availableWords.splice(i, 1)[0];
      usedWords.add(currentWord);
      gameArea.textContent = currentWord;
    }

    function endGame(includeCurrent = false) {
      playing = false;
      clearInterval(interval);

      gameArea.style.display = "none";
      timerEl.style.display = "none";

      if (includeCurrent && currentWord) {
        results.push({ word: currentWord, correct: false });
      }

      const correct = results.filter(r => r.correct).length;
      resultsContent.innerHTML =
        `<p>Score: ${correct} / ${results.length}</p>
         <ul>${results.map(r =>
           `<li class="${r.correct ? 'correct' : 'missed'}">${r.word}</li>`
         ).join('')}</ul>
         <p>(Tap to restart)</p>`;

      resultsOverlay.style.display = 'flex';
      document.getElementById('endSound').play().catch(()=>{});
    }

    function nextWord(correct) {
      if (!playing) return;
      results.push({ word: currentWord, correct });
      showWord();
    }

    startBtn.onclick = async () => {
      const file = presetSelect.value;
      if (!file) return;

      words = await loadWords(file);

      availableWords = words.filter(w => !usedWords.has(w));
      if (availableWords.length === 0) {
        usedWords.clear();
        availableWords = [...words];
      }

      results = [];
      timeLeft = +timeInput.value || 60;

      controlsEl.style.display = "none";
      gameArea.style.display = "flex";
      timerEl.style.display = "block";
      resultsOverlay.style.display = "none";

      showWord();
      playing = true;
      document.getElementById('startSound').play().catch(()=>{});

      timerEl.textContent = `Time: ${timeLeft}`;
      interval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = `Time: ${timeLeft}`;

        if (timeLeft > 0 && timeLeft < 10) {
          document.getElementById('countdownSound').play().catch(()=>{});
        }

        if (timeLeft <= 0) endGame(true);
      }, 1000);
    };

    gameArea.onclick = e => {
      if (!playing) return;
      nextWord(e.clientX > innerWidth / 2);
    };

    resultsOverlay.onclick = () => {
      resultsOverlay.style.display = 'none';
      controlsEl.style.display = 'block';
    };

    loadWordLists();
  </script>
</body>
</html>
